h1. Tag Parsing Textformatter Module For ProcessWire

Substitutes tags in a given text block with values from a context (or an array of contexts). Each context provider must be an instance of WireData. This means that almost any object from ProcessWire can be used by the parser to do substitutions.

Given an input string such as: 

bc. "Date: {datetime}\nUser: {name}\nIP:   {REMOTE_ADDR}"

...and a user object as context, you might get something like this as the result...

bc.. Date: 12th September 2012, 14:45
User: ryan
IP:   127.0.0.1

p. ...of course, your mileage may vary.

h2. Installation

# Copy TextformatterTagParser.module to your site/modules directory
# Login to the admin interface
# Navigate to the modules page
# Click the "Check for new modules"
# Click on the name "TextformatterTagParser" in the message that appears or scroll to the bottom of the screen to locate the correct entry
# Click the "Install" button.


h2. Tags

Tags must take one of the forms...

# {fieldname} 
# {context.fieldname}

The first form can be used regardless of how many contexts are setup in the parser, whilst the second form is used to specified which context to extract the fieldname from when using multiple contexts. For example, {page.name} is more specific than just {name}. If no context specifier is used in a tag then contexts will be searched for a match in the order in which they appear in the context array and the first match will be used for the substitution.

The value of _fieldname_ can be any field accessible in any context or from the $_SERVER globals or one of the following special fields...

|_. Special Tag |_. Description |
| {datetime} | The current date & time as formatted according to the dateFormat value in your site's config.php file. |

Special tags override other context fields with the same name so if you want to include the datetime from one of your context objects you need to specify the context in the tag (eg. "{login.datetime}").

h2. Usage

h3. Getting a parser object:

bc. $parser = wire()->modules->get("TextformatterTagParser"); 

h3. Setting a single context:

bc. $parser->set('context', $user);

h3. Setting multiple contexts:
  
bc. $parser->set('context', array('user'=>$user, 'page'=>$page) );

If you are using multiple contexts, you will probably need to use the _{context.fieldname}_ tag format in your input strings to avoid ambiguity when the parser looks for substitutions.

h3. Parsing a string:

Parsing is done after setting a context using the format() method.

bc. $parser->format($string);

*NB:* The string is passed to format() by reference and *the value is changed* by the parser.

h3. Putting it together:

You can format as many blocks as you want with a given parser & context...

bc.. $body = "...";    // Setup the email body template
$subject = "..."; // Setup the email subject template
$parser = wire()->modules->get("TextformatterTagParser");
$parser
    ->set('context', $user)
    ->format($subject)
    ->format($body)
    ;
$sent = @email($user->email, $subject, $body);

p. You can setup new contexts on a given parser instance between format() calls.

h2. License

GPLv2
